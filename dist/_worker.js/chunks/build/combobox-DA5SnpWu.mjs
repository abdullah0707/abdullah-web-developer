import{u as e}from"../_/nitro.mjs";import{c as o,u as n,s as l,w as i,M as a,J as s}from"../routes/renderer.mjs";import{d as r,e as u}from"./form-D2zNWe3d.mjs";import{t as d,o as c}from"./active-element-history-Cer4cSOw.mjs";import{i as v,o as m,A as f,T as h,u as b,E as g,N as x,a as O}from"./keyboard-CAJ_aYVR.mjs";import{w as y,n as R}from"./use-outside-click-C5-WFuny.mjs";import{s as C}from"./use-resolve-button-type-mmKhQN3O.mjs";import{u as w,i as E,c as T,f as z}from"./calculate-active-index-8KfbvCxF.mjs";import{f as F,u as P}from"./hidden-C_dNCCVv.mjs";import{l as A,i as k,t as j}from"./open-closed-yxKiGq4R.mjs";import{i as V,O as _}from"./focus-management-pwSlEFwO.mjs";import{v as W}from"./server.mjs";function memo(e,o,n){let l,i=n.initialDeps??[];function memoizedFunction(){var a,s,r,u;let d;n.key&&(null==(a=n.debug)?void 0:a.call(n))&&(d=Date.now());const c=e();if(!(c.length!==i.length||c.some((e,o)=>i[o]!==e)))return l;let v;if(i=c,n.key&&(null==(s=n.debug)?void 0:s.call(n))&&(v=Date.now()),l=o(...c),n.key&&(null==(r=n.debug)?void 0:r.call(n))){const e=Math.round(100*(Date.now()-d))/100,o=Math.round(100*(Date.now()-v))/100,l=o/16,pad=(e,o)=>{for(e=String(e);e.length<o;)e=" "+e;return e};console.info(`%câ± ${pad(o,5)} /${pad(e,5)} ms`,`\n            font-size: .6rem;\n            font-weight: bold;\n            color: hsl(${Math.max(0,Math.min(120-120*l,120))}deg 100% 31%);`,null==n?void 0:n.key)}return null==(u=null==n?void 0:n.onChange)||u.call(n,l),l}return memoizedFunction.updateDeps=e=>{i=e},memoizedFunction}function notUndefined(e,o){if(void 0===e)throw new Error("Unexpected undefined");return e}const debounce=(e,o,n)=>{let l;return function(...i){e.clearTimeout(l),l=e.setTimeout(()=>o.apply(this,i),n)}},getRect=e=>{const{offsetWidth:o,offsetHeight:n}=e;return{width:o,height:n}},defaultKeyExtractor=e=>e,defaultRangeExtractor=e=>{const o=Math.max(e.startIndex-e.overscan,0),n=Math.min(e.endIndex+e.overscan,e.count-1),l=[];for(let e=o;e<=n;e++)l.push(e);return l},observeElementRect=(e,o)=>{const n=e.scrollElement;if(!n)return;const l=e.targetWindow;if(!l)return;const handler=e=>{const{width:n,height:l}=e;o({width:Math.round(n),height:Math.round(l)})};if(handler(getRect(n)),!l.ResizeObserver)return()=>{};const i=new l.ResizeObserver(o=>{const run=()=>{const e=o[0];if(null==e?void 0:e.borderBoxSize){const o=e.borderBoxSize[0];if(o)return void handler({width:o.inlineSize,height:o.blockSize})}handler(getRect(n))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(run):run()});return i.observe(n,{box:"border-box"}),()=>{i.unobserve(n)}},N={passive:!0},L=!0,observeElementOffset=(e,o)=>{const n=e.scrollElement;if(!n)return;const l=e.targetWindow;if(!l)return;let i=0;const a=e.options.useScrollendEvent?()=>{}:debounce(l,()=>{o(i,!1)},e.options.isScrollingResetDelay),createHandler=l=>()=>{const{horizontal:s,isRtl:r}=e.options;i=s?n.scrollLeft*(r?-1:1):n.scrollTop,a(),o(i,l)},s=createHandler(!0),r=createHandler(!1);r(),n.addEventListener("scroll",s,N);const u=e.options.useScrollendEvent&&L;return u&&n.addEventListener("scrollend",r,N),()=>{n.removeEventListener("scroll",s),u&&n.removeEventListener("scrollend",r)}},measureElement=(e,o,n)=>{if(null==o?void 0:o.borderBoxSize){const e=o.borderBoxSize[0];if(e){return Math.round(e[n.options.horizontal?"inlineSize":"blockSize"])}}return e[n.options.horizontal?"offsetWidth":"offsetHeight"]},elementScroll=(e,{adjustments:o=0,behavior:n},l)=>{var i,a;const s=e+o;null==(a=null==(i=l.scrollElement)?void 0:i.scrollTo)||a.call(i,{[l.options.horizontal?"left":"top"]:s,behavior:n})};class Virtualizer{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null;const get=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{const run=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(run):run()})}):null);return{disconnect:()=>{var o;null==(o=get())||o.disconnect(),e=null},observe:e=>{var o;return null==(o=get())?void 0:o.observe(e,{box:"border-box"})},unobserve:e=>{var o;return null==(o=get())?void 0:o.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([o,n])=>{void 0===n&&delete e[o]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:defaultKeyExtractor,rangeExtractor:defaultRangeExtractor,onChange:()=>{},measureElement:measureElement,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var o,n;null==(n=(o=this.options).onChange)||n.call(o,this,e)},this.maybeNotify=memo(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;const o=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==o){if(this.cleanup(),!o)return void this.maybeNotify();this.scrollElement=o,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,o)=>{this.scrollAdjustments=0,this.scrollDirection=o?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=o,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,o)=>{const n=new Map,l=new Map;for(let i=o-1;i>=0;i--){const o=e[i];if(n.has(o.lane))continue;const a=l.get(o.lane);if(null==a||o.end>a.end?l.set(o.lane,o):o.end<a.end&&n.set(o.lane,!0),n.size===this.options.lanes)break}return l.size===this.options.lanes?Array.from(l.values()).sort((e,o)=>e.end===o.end?e.index-o.index:e.end-o.end)[0]:void 0},this.getMeasurementOptions=memo(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(e,o,n,l,i)=>(this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:o,scrollMargin:n,getItemKey:l,enabled:i}),{key:!1}),this.getMeasurements=memo(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:o,scrollMargin:n,getItemKey:l,enabled:i},a)=>{if(!i)return this.measurementsCache=[],this.itemSizeCache.clear(),[];0===this.measurementsCache.length&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));const s=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const r=this.measurementsCache.slice(0,s);for(let i=s;i<e;i++){const e=l(i),s=1===this.options.lanes?r[i-1]:this.getFurthestMeasurement(r,i),u=s?s.end+this.options.gap:o+n,d=a.get(e),c="number"==typeof d?d:this.options.estimateSize(i),v=u+c,m=s?s.lane:i%this.options.lanes;r[i]={index:i,start:u,size:c,end:v,key:e,lane:m}}return this.measurementsCache=r,r},{key:!1,debug:()=>this.options.debug}),this.calculateRange=memo(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,o,n,l)=>this.range=e.length>0&&o>0?function({measurements:e,outerSize:o,scrollOffset:n,lanes:l}){const i=e.length-1,getOffset=o=>e[o].start;if(e.length<=l)return{startIndex:0,endIndex:i};let a=findNearestBinarySearch(0,i,getOffset,n),s=a;if(1===l)for(;s<i&&e[s].end<n+o;)s++;else if(l>1){const r=Array(l).fill(0);for(;s<i&&r.some(e=>e<n+o);){const o=e[s];r[o.lane]=o.end,s++}const u=Array(l).fill(n+o);for(;a>=0&&u.some(e=>e>=n);){const o=e[a];u[o.lane]=o.start,a--}a=Math.max(0,a-a%l),s=Math.min(i,s+(l-1-s%l))}return{startIndex:a,endIndex:s}}({measurements:e,outerSize:o,scrollOffset:n,lanes:l}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=memo(()=>{let e=null,o=null;const n=this.calculateRange();return n&&(e=n.startIndex,o=n.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,o]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,o]},(e,o,n,l,i)=>null===l||null===i?[]:e({startIndex:l,endIndex:i,overscan:o,count:n}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{const o=this.options.indexAttribute,n=e.getAttribute(o);return n?parseInt(n,10):(console.warn(`Missing attribute name '${o}={index}' on measured element.`),-1)},this._measureElement=(e,o)=>{const n=this.indexFromElement(e),l=this.measurementsCache[n];if(!l)return;const i=l.key,a=this.elementsCache.get(i);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.elementsCache.set(i,e)),e.isConnected&&this.resizeItem(n,this.options.measureElement(e,o,this))},this.resizeItem=(e,o)=>{const n=this.measurementsCache[e];if(!n)return;const l=o-(this.itemSizeCache.get(n.key)??n.size);0!==l&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(n,l,this):n.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=l,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(n.index),this.itemSizeCache=new Map(this.itemSizeCache.set(n.key,o)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,o)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(o))})},this.getVirtualItems=memo(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,o)=>{const n=[];for(let l=0,i=e.length;l<i;l++){const i=o[e[l]];n.push(i)}return n},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{const o=this.getMeasurements();if(0!==o.length)return notUndefined(o[findNearestBinarySearch(0,o.length-1,e=>notUndefined(o[e]).start,e)])},this.getOffsetForAlignment=(e,o,n=0)=>{const l=this.getSize(),i=this.getScrollOffset();"auto"===o&&(o=e>=i+l?"end":"start"),"center"===o?e+=(n-l)/2:"end"===o&&(e-=l);const a=this.getTotalSize()+this.options.scrollMargin-l;return Math.max(Math.min(a,e),0)},this.getOffsetForIndex=(e,o="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));const n=this.measurementsCache[e];if(!n)return;const l=this.getSize(),i=this.getScrollOffset();if("auto"===o)if(n.end>=i+l-this.options.scrollPaddingEnd)o="end";else{if(!(n.start<=i+this.options.scrollPaddingStart))return[i,o];o="start"}const a="end"===o?n.end+this.options.scrollPaddingEnd:n.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,o,n.size),o]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:o="start",behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,o),{adjustments:void 0,behavior:n})},this.scrollToIndex=(e,{align:o="auto",behavior:n}={})=>{"smooth"===n&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1));let l=0;const tryScroll=o=>{if(!this.targetWindow)return;const l=this.getOffsetForIndex(e,o);if(!l)return void console.warn("Failed to get offset for index:",e);const[i,a]=l;this._scrollToOffset(i,{adjustments:void 0,behavior:n}),this.targetWindow.requestAnimationFrame(()=>{const o=this.getScrollOffset(),n=this.getOffsetForIndex(e,a);var l,i;n?(l=n[0],i=o,Math.abs(l-i)<1.01||scheduleRetry(a)):console.warn("Failed to get offset for index:",e)})},scheduleRetry=o=>{this.targetWindow&&(l++,l<10?this.targetWindow.requestAnimationFrame(()=>tryScroll(o)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};tryScroll(o)},this.scrollBy=(e,{behavior:o}={})=>{"smooth"===o&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:o})},this.getTotalSize=()=>{var e;const o=this.getMeasurements();let n;if(0===o.length)n=this.options.paddingStart;else if(1===this.options.lanes)n=(null==(e=o[o.length-1])?void 0:e.end)??0;else{const e=Array(this.options.lanes).fill(null);let l=o.length-1;for(;l>=0&&e.some(e=>null===e);){const n=o[l];null===e[n.lane]&&(e[n.lane]=n.end),l--}n=Math.max(...e.filter(e=>null!==e))}return Math.max(n-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:o,behavior:n})=>{this.options.scrollToFn(e,{behavior:n,adjustments:o},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(e)}}const findNearestBinarySearch=(e,o,n,l)=>{for(;e<=o;){const i=(e+o)/2|0,a=n(i);if(a<l)e=i+1;else{if(!(a>l))return i;o=i-1}}return e>0?e-1:0};function useVirtualizer(e){return function(e){const o=new Virtualizer(n(e)),r=l(o),u=o._didMount();return i(()=>n(e).getScrollElement(),e=>{e&&o._willUpdate()},{immediate:!0}),i(()=>n(e),e=>{o.setOptions({...e,onChange:(o,n)=>{var l;a(r),null==(l=e.onChange)||l.call(e,o,n)}}),o._willUpdate(),a(r)},{immediate:!0}),s(u),r}(o(()=>({observeElementRect:observeElementRect,observeElementOffset:observeElementOffset,scrollToFn:elementScroll,...n(e)})))}function t(){let e=c();return o=>{e.dispose(),e.nextFrame(o)}}var U,q=((U=q||{})[U.Left=0]="Left",U[U.Right=2]="Right",U);var H,J,Y=((J=Y||{})[J.Open=0]="Open",J[J.Closed=1]="Closed",J),G=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(G||{}),Q=((H=Q||{})[H.Pointer=0]="Pointer",H[H.Focus=1]="Focus",H[H.Other=2]="Other",H);let X=Symbol("ComboboxContext");function K(e){let o=W.inject(X,null);if(null===o){let o=new Error(`<${e} /> is missing a parent <Combobox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,K),o}return o}let Z=Symbol("VirtualContext"),ee=W.defineComponent({name:"VirtualProvider",setup(o,{slots:n}){let l=K("VirtualProvider"),i=W.computed(()=>{let e=m(l.optionsRef);if(!e)return{start:0,end:0};let o=(void 0).getComputedStyle(e);return{start:parseFloat(o.paddingBlockStart||o.paddingTop),end:parseFloat(o.paddingBlockEnd||o.paddingBottom)}}),a=useVirtualizer(W.computed(()=>({scrollPaddingStart:i.value.start,scrollPaddingEnd:i.value.end,count:l.virtual.value.options.length,estimateSize:()=>40,getScrollElement:()=>m(l.optionsRef),overscan:12}))),s=W.computed(()=>{var e;return null==(e=l.virtual.value)?void 0:e.options}),r=W.ref(0);return W.watch([s],()=>{r.value+=1}),W.provide(Z,l.virtual.value?a:null),()=>[W.h("div",{style:{position:"relative",width:"100%",height:`${a.value.getTotalSize()}px`},ref:o=>{if(o){if(void 0!==e&&void 0!==e.env.JEST_WORKER_ID||0===l.activationTrigger.value)return;null!==l.activeOptionIndex.value&&l.virtual.value.options.length>l.activeOptionIndex.value&&a.value.scrollToIndex(l.activeOptionIndex.value)}}},a.value.getVirtualItems().map(e=>W.cloneVNode(n.default({option:l.virtual.value.options[e.index],open:0===l.comboboxState.value})[0],{key:`${r.value}-${e.index}`,"data-index":e.index,"aria-setsize":l.virtual.value.options.length,"aria-posinset":e.index+1,style:{position:"absolute",top:0,left:0,transform:`translateY(${e.start}px)`,overflowAnchor:"none"}})))]}}),te=W.defineComponent({name:"Combobox",emits:{"update:modelValue":e=>!0},props:{as:{type:[Object,String],default:"template"},disabled:{type:[Boolean],default:!1},by:{type:[String,Function],nullable:!0,default:null},modelValue:{type:[Object,String,Number,Boolean],default:void 0},defaultValue:{type:[Object,String,Number,Boolean],default:void 0},form:{type:String,optional:!0},name:{type:String,optional:!0},nullable:{type:Boolean,default:!1},multiple:{type:[Boolean],default:!1},immediate:{type:[Boolean],default:!1},virtual:{type:Object,default:null}},inheritAttrs:!1,setup(e,{slots:o,attrs:n,emit:l}){let i=W.ref(1),a=W.ref(null),s=W.ref(null),d=W.ref(null),c=W.ref(null),v=W.ref({static:!1,hold:!1}),x=W.ref([]),O=W.ref(null),R=W.ref(2),C=W.ref(!1);function w$1(e=e=>e){let o=null!==O.value?x.value[O.value]:null,n=e(x.value.slice()),l=n.length>0&&null!==n[0].dataRef.order.value?n.sort((e,o)=>e.dataRef.order.value-o.dataRef.order.value):_(n,e=>m(e.dataRef.domRef)),i=o?l.indexOf(o):null;return-1===i&&(i=null),{options:l,activeOptionIndex:i}}let w=W.computed(()=>e.multiple?1:0),E=W.computed(()=>e.nullable),[A,V]=r(W.computed(()=>e.modelValue),e=>l("update:modelValue",e),W.computed(()=>e.defaultValue)),N=W.computed(()=>void 0===A.value?b(w.value,{1:[],0:void 0}):A.value),L=null,U=null;function I(e){return b(w.value,{0:()=>null==V?void 0:V(e),1:()=>{let o=W.toRaw(H.value.value).slice(),n=W.toRaw(e),l=o.findIndex(e=>H.compare(n,W.toRaw(e)));return-1===l?o.push(n):o.splice(l,1),null==V?void 0:V(o)}})}let q=W.computed(()=>{});W.watch([q],([e],[o])=>{if(H.virtual.value&&e&&o&&null!==O.value){let n=e.indexOf(o[O.value]);O.value=-1!==n?n:null}});let H={comboboxState:i,value:N,mode:w,compare(o,n){if("string"==typeof e.by){let l=e.by;return(null==o?void 0:o[l])===(null==n?void 0:n[l])}return null===e.by?function(e,o){return e===o}(o,n):e.by(o,n)},calculateIndex:o=>H.virtual.value?null===e.by?H.virtual.value.options.indexOf(o):H.virtual.value.options.findIndex(e=>H.compare(e,o)):x.value.findIndex(e=>H.compare(e.dataRef.value,o)),defaultValue:W.computed(()=>e.defaultValue),nullable:E,immediate:W.computed(()=>!1),virtual:W.computed(()=>null),inputRef:s,labelRef:a,buttonRef:d,optionsRef:c,disabled:W.computed(()=>e.disabled),options:x,change(e){V(e)},activeOptionIndex:W.computed(()=>{if(C.value&&null===O.value&&(H.virtual.value?H.virtual.value.options.length>0:x.value.length>0)){if(H.virtual.value){let e=H.virtual.value.options.findIndex(e=>{var o;return!(null!=(o=H.virtual.value)&&o.disabled(e))});if(-1!==e)return e}let e=x.value.findIndex(e=>!e.dataRef.disabled);if(-1!==e)return e}return O.value}),activationTrigger:R,optionsPropsRef:v,closeCombobox(){C.value=!1,!e.disabled&&1!==i.value&&(i.value=1,O.value=null)},openCombobox(){if(C.value=!0,!e.disabled&&0!==i.value){if(H.value.value){let e=H.calculateIndex(H.value.value);-1!==e&&(O.value=e)}i.value=0}},setActivationTrigger(e){R.value=e},goToOption(o,n,l){C.value=!1,null!==L&&cancelAnimationFrame(L),L=requestAnimationFrame(()=>{if(e.disabled||c.value&&!v.value.static&&1===i.value)return;if(H.virtual.value)return O.value=o===T.Specific?n:z({focus:o},{resolveItems:()=>H.virtual.value.options,resolveActiveIndex:()=>{var e,o;return null!=(o=null!=(e=H.activeOptionIndex.value)?e:H.virtual.value.options.findIndex(e=>{var o;return!(null!=(o=H.virtual.value)&&o.disabled(e))}))?o:null},resolveDisabled:e=>H.virtual.value.disabled(e),resolveId(){throw new Error("Function not implemented.")}}),void(R.value=null!=l?l:2);let a=w$1();if(null===a.activeOptionIndex){let e=a.options.findIndex(e=>!e.dataRef.disabled);-1!==e&&(a.activeOptionIndex=e)}let s=o===T.Specific?n:z({focus:o},{resolveItems:()=>a.options,resolveActiveIndex:()=>a.activeOptionIndex,resolveId:e=>e.id,resolveDisabled:e=>e.dataRef.disabled});O.value=s,R.value=null!=l?l:2,x.value=a.options})},selectOption(e){let o=x.value.find(o=>o.id===e);if(!o)return;let{dataRef:n}=o;I(n.value)},selectActiveOption(){if(null!==H.activeOptionIndex.value){if(H.virtual.value)I(H.virtual.value.options[H.activeOptionIndex.value]);else{let{dataRef:e}=x.value[H.activeOptionIndex.value];I(e.value)}H.goToOption(T.Specific,H.activeOptionIndex.value)}},registerOption(e,o){let n=W.reactive({id:e,dataRef:o});if(H.virtual.value)return void x.value.push(n);U&&cancelAnimationFrame(U);let l=w$1(e=>(e.push(n),e));null===O.value&&H.isSelected(o.value.value)&&(l.activeOptionIndex=l.options.indexOf(n)),x.value=l.options,O.value=l.activeOptionIndex,R.value=2,l.options.some(e=>!m(e.dataRef.domRef))&&(U=requestAnimationFrame(()=>{let e=w$1();x.value=e.options,O.value=e.activeOptionIndex}))},unregisterOption(e,o){if(null!==L&&cancelAnimationFrame(L),o&&(C.value=!0),H.virtual.value)return void(x.value=x.value.filter(o=>o.id!==e));let n=w$1(o=>{let n=o.findIndex(o=>o.id===e);return-1!==n&&o.splice(n,1),o});x.value=n.options,O.value=n.activeOptionIndex,R.value=2},isSelected:e=>b(w.value,{0:()=>H.compare(W.toRaw(H.value.value),W.toRaw(e)),1:()=>W.toRaw(H.value.value).some(o=>H.compare(W.toRaw(o),W.toRaw(e)))}),isActive:e=>O.value===H.calculateIndex(e)};return y([s,d,c],()=>H.closeCombobox(),W.computed(()=>0===i.value)),W.provide(X,H),j(W.computed(()=>b(i.value,{0:k.Open,1:k.Closed}))),W.computed(()=>{var e;return null==(e=m(s))?void 0:e.closest("form")}),()=>{var l,a,s;let{name:r,disabled:d,form:c,...v}=e,m={open:0===i.value,disabled:d,activeIndex:H.activeOptionIndex.value,activeOption:null===H.activeOptionIndex.value?null:H.virtual.value?H.virtual.value.options[null!=(l=H.activeOptionIndex.value)?l:0]:null!=(s=null==(a=H.options.value[H.activeOptionIndex.value])?void 0:a.dataRef.value)?s:null,value:N.value};return W.h(W.Fragment,[...null!=r&&null!=N.value?u({[r]:N.value}).map(([e,o])=>W.h(F,g({features:P.Hidden,key:e,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:c,disabled:d,name:e,value:o}))):[],f({theirProps:{...n,...h(v,["by","defaultValue","immediate","modelValue","multiple","nullable","onUpdate:modelValue","virtual"])},ourProps:{},slot:m,slots:o,attrs:n,name:"Combobox"})])}}});W.defineComponent({name:"ComboboxLabel",props:{as:{type:[Object,String],default:"label"},id:{type:String,default:null}},setup(e,{attrs:o,slots:n}){var l;let i=null!=(l=e.id)?l:`headlessui-combobox-label-${v()}`,a=K("ComboboxLabel");function u2(){var e;null==(e=m(a.inputRef))||e.focus({preventScroll:!0})}return()=>{let l={open:0===a.comboboxState.value,disabled:a.disabled.value},{...s}=e,r={id:i,ref:a.labelRef,onClick:u2};return f({ourProps:r,theirProps:s,slot:l,attrs:o,slots:n,name:"ComboboxLabel"})}}});let oe=W.defineComponent({name:"ComboboxButton",props:{as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(e,{attrs:o,slots:n,expose:l}){var i;let a=null!=(i=e.id)?i:`headlessui-combobox-button-${v()}`,s=K("ComboboxButton");function e2(e){s.disabled.value||(0===s.comboboxState.value?s.closeCombobox():(e.preventDefault(),s.openCombobox()),W.nextTick(()=>{var e;return null==(e=m(s.inputRef))?void 0:e.focus({preventScroll:!0})}))}function c$1(e){switch(e.key){case O.ArrowDown:return e.preventDefault(),e.stopPropagation(),1===s.comboboxState.value&&s.openCombobox(),void W.nextTick(()=>{var e;return null==(e=s.inputRef.value)?void 0:e.focus({preventScroll:!0})});case O.ArrowUp:return e.preventDefault(),e.stopPropagation(),1===s.comboboxState.value&&(s.openCombobox(),W.nextTick(()=>{s.value.value||s.goToOption(T.Last)})),void W.nextTick(()=>{var e;return null==(e=s.inputRef.value)?void 0:e.focus({preventScroll:!0})});case O.Escape:if(0!==s.comboboxState.value)return;return e.preventDefault(),s.optionsRef.value&&!s.optionsPropsRef.value.static&&e.stopPropagation(),s.closeCombobox(),void W.nextTick(()=>{var e;return null==(e=s.inputRef.value)?void 0:e.focus({preventScroll:!0})})}}l({el:s.buttonRef,$el:s.buttonRef});let r=C(W.computed(()=>({as:e.as,type:o.type})),s.buttonRef);return()=>{var l,i;let u={open:0===s.comboboxState.value,disabled:s.disabled.value,value:s.value.value},{...d}=e,c={ref:s.buttonRef,id:a,type:r.value,tabindex:"-1","aria-haspopup":"listbox","aria-controls":null==(l=m(s.optionsRef))?void 0:l.id,"aria-expanded":0===s.comboboxState.value,"aria-labelledby":s.labelRef.value?[null==(i=m(s.labelRef))?void 0:i.id,a].join(" "):void 0,disabled:!0===s.disabled.value||void 0,onKeydown:c$1,onClick:e2};return f({ourProps:c,theirProps:d,slot:u,attrs:o,slots:n,name:"ComboboxButton"})}}}),ne=W.defineComponent({name:"ComboboxInput",props:{as:{type:[Object,String],default:"input"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},displayValue:{type:Function},defaultValue:{type:String,default:void 0},id:{type:String,default:null}},emits:{change:e=>!0},setup(e,{emit:o,attrs:n,slots:l,expose:i}){var a;let s=null!=(a=e.id)?a:`headlessui-combobox-input-${v()}`,r=K("ComboboxInput");function S(){r.change(null);let e=m(r.optionsRef);e&&(e.scrollTop=0),r.goToOption(T.Nothing)}W.computed(()=>V(m(r.inputRef))),i({el:r.inputRef,$el:r.inputRef}),W.computed(()=>{var o;let n=r.value.value;return m(r.inputRef)?void 0!==e.displayValue&&void 0!==n?null!=(o=e.displayValue(n))?o:"":"string"==typeof n?n:"":""});let u=W.ref(!1);function D(){u.value=!0}function E2(){c().nextFrame(()=>{u.value=!1})}let h=t();function M(e){switch(h(()=>{}),e.key){case O.Enter:if(0!==r.comboboxState.value||u.value)return;if(e.preventDefault(),e.stopPropagation(),null===r.activeOptionIndex.value)return void r.closeCombobox();r.selectActiveOption(),0===r.mode.value&&r.closeCombobox();break;case O.ArrowDown:return e.preventDefault(),e.stopPropagation(),b(r.comboboxState.value,{0:()=>r.goToOption(T.Next),1:()=>r.openCombobox()});case O.ArrowUp:return e.preventDefault(),e.stopPropagation(),b(r.comboboxState.value,{0:()=>r.goToOption(T.Previous),1:()=>{r.openCombobox(),W.nextTick(()=>{r.value.value||r.goToOption(T.Last)})}});case O.Home:if(e.shiftKey)break;return e.preventDefault(),e.stopPropagation(),r.goToOption(T.First);case O.PageUp:return e.preventDefault(),e.stopPropagation(),r.goToOption(T.First);case O.End:if(e.shiftKey)break;return e.preventDefault(),e.stopPropagation(),r.goToOption(T.Last);case O.PageDown:return e.preventDefault(),e.stopPropagation(),r.goToOption(T.Last);case O.Escape:if(0!==r.comboboxState.value)return;e.preventDefault(),r.optionsRef.value&&!r.optionsPropsRef.value.static&&e.stopPropagation(),r.nullable.value&&0===r.mode.value&&null===r.value.value&&S(),r.closeCombobox();break;case O.Tab:if(0!==r.comboboxState.value)return;0===r.mode.value&&1!==r.activationTrigger.value&&r.selectActiveOption(),r.closeCombobox()}}function $(e){o("change",e),r.nullable.value&&0===r.mode.value&&""===e.target.value&&S(),r.openCombobox()}function B(e){var o,n,l;let i=null!=(o=e.relatedTarget)?o:d.find(o=>o!==e.currentTarget);if(!(null!=(n=m(r.optionsRef))&&n.contains(i)||null!=(l=m(r.buttonRef))&&l.contains(i)||0!==r.comboboxState.value))return e.preventDefault(),0===r.mode.value&&(r.nullable.value&&null===r.value.value?S():1!==r.activationTrigger.value&&r.selectActiveOption()),r.closeCombobox()}function p(e){var o,n,l;let i=null!=(o=e.relatedTarget)?o:d.find(o=>o!==e.currentTarget);null!=(n=m(r.buttonRef))&&n.contains(i)||null!=(l=m(r.optionsRef))&&l.contains(i)||r.disabled.value||r.immediate.value&&0!==r.comboboxState.value&&(r.openCombobox(),c().nextFrame(()=>{r.setActivationTrigger(1)}))}let g=W.computed(()=>{var o,n,l,i;return null!=(i=null!=(l=null!=(n=e.defaultValue)?n:void 0!==r.defaultValue.value?null==(o=e.displayValue)?void 0:o.call(e,r.defaultValue.value):null)?l:r.defaultValue.value)?i:""});return()=>{var o,i,a,u,d,c,v;let h={open:0===r.comboboxState.value},{displayValue:b,onChange:O,...y}=e,R={"aria-controls":null==(o=r.optionsRef.value)?void 0:o.id,"aria-expanded":0===r.comboboxState.value,"aria-activedescendant":null===r.activeOptionIndex.value?void 0:r.virtual.value?null==(i=r.options.value.find(e=>!r.virtual.value.disabled(e.dataRef.value)&&r.compare(e.dataRef.value,r.virtual.value.options[r.activeOptionIndex.value])))?void 0:i.id:null==(a=r.options.value[r.activeOptionIndex.value])?void 0:a.id,"aria-labelledby":null!=(c=null==(u=m(r.labelRef))?void 0:u.id)?c:null==(d=m(r.buttonRef))?void 0:d.id,"aria-autocomplete":"list",id:s,onCompositionstart:D,onCompositionend:E2,onKeydown:M,onInput:$,onFocus:p,onBlur:B,role:"combobox",type:null!=(v=n.type)?v:"text",tabIndex:0,ref:r.inputRef,defaultValue:g.value,disabled:!0===r.disabled.value||void 0};return f({ourProps:R,theirProps:y,slot:h,attrs:n,slots:l,features:x.RenderStrategy|x.Static,name:"ComboboxInput"})}}}),le=W.defineComponent({name:"ComboboxOptions",props:{as:{type:[Object,String],default:"ul"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},hold:{type:[Boolean],default:!1}},setup(e,{attrs:o,slots:n,expose:l}){let i=K("ComboboxOptions"),a=`headlessui-combobox-options-${v()}`;l({el:i.optionsRef,$el:i.optionsRef}),W.watchEffect(()=>{i.optionsPropsRef.value.static=e.static}),W.watchEffect(()=>{i.optionsPropsRef.value.hold=e.hold});let s=A(),r=W.computed(()=>null!==s?(s.value&k.Open)===k.Open:0===i.comboboxState.value);function f2(e){e.preventDefault()}return E({container:W.computed(()=>m(i.optionsRef)),enabled:W.computed(()=>0===i.comboboxState.value),accept:e=>"option"===e.getAttribute("role")?NodeFilter.FILTER_REJECT:e.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT,walk(e){e.setAttribute("role","none")}}),()=>{var l,s,u;let d={open:0===i.comboboxState.value},c={"aria-labelledby":null!=(u=null==(l=m(i.labelRef))?void 0:l.id)?u:null==(s=m(i.buttonRef))?void 0:s.id,id:a,ref:i.optionsRef,role:"listbox","aria-multiselectable":1===i.mode.value||void 0,onMousedown:f2},v=h(e,["hold"]);return f({ourProps:c,theirProps:v,slot:d,attrs:o,slots:i.virtual.value&&0===i.comboboxState.value?{...n,default:()=>[W.h(ee,{},n.default)]}:n,features:x.RenderStrategy|x.Static,visible:r.value,name:"ComboboxOptions"})}}}),ie=W.defineComponent({name:"ComboboxOption",props:{as:{type:[Object,String],default:"li"},value:{type:[Object,String,Number,Boolean]},disabled:{type:Boolean,default:!1},order:{type:[Number],default:null}},setup(e,{slots:o,attrs:n,expose:l}){let i=K("ComboboxOption"),a=`headlessui-combobox-option-${v()}`,s=W.ref(null),r=W.computed(()=>e.disabled);l({el:s,$el:s});let u=W.computed(()=>{var o;return i.virtual.value?i.activeOptionIndex.value===i.calculateIndex(e.value):null!==i.activeOptionIndex.value&&(null==(o=i.options.value[i.activeOptionIndex.value])?void 0:o.id)===a}),d=W.computed(()=>i.isSelected(e.value)),c=W.inject(Z,null);function D(e){e.preventDefault(),e.button===q.Left&&(r.value||(i.selectOption(a),R()||requestAnimationFrame(()=>{var e;return null==(e=m(i.inputRef))?void 0:e.focus({preventScroll:!0})}),0===i.mode.value&&i.closeCombobox()))}function E2(){var o;if(e.disabled||null!=(o=i.virtual.value)&&o.disabled(e.value))return i.goToOption(T.Nothing);let n=i.calculateIndex(e.value);i.goToOption(T.Specific,n)}W.computed(()=>({disabled:e.disabled,value:e.value,domRef:s,order:W.computed(()=>e.order)})),W.watchEffect(()=>{let e=m(s);e&&(null==c||c.value.measureElement(e))}),W.watchEffect(()=>{0===i.comboboxState.value&&u.value&&(i.virtual.value||0!==i.activationTrigger.value&&W.nextTick(()=>{var e,o;return null==(o=null==(e=m(s))?void 0:e.scrollIntoView)?void 0:o.call(e,{block:"nearest"})}))});let b=w();function M(e){b.update(e)}function $(o){var n;if(!b.wasMoved(o)||e.disabled||null!=(n=i.virtual.value)&&n.disabled(e.value)||u.value)return;let l=i.calculateIndex(e.value);i.goToOption(T.Specific,l,0)}function B(o){var n;b.wasMoved(o)&&(e.disabled||null!=(n=i.virtual.value)&&n.disabled(e.value)||u.value&&(i.optionsPropsRef.value.hold||i.goToOption(T.Nothing)))}return()=>{let{disabled:l}=e,i={active:u.value,selected:d.value,disabled:l},r={id:a,ref:s,role:"option",tabIndex:!0===l?void 0:-1,"aria-disabled":!0===l||void 0,"aria-selected":d.value,disabled:void 0,onMousedown:D,onFocus:E2,onPointerenter:M,onMouseenter:M,onPointermove:$,onMousemove:$,onPointerleave:B,onMouseleave:B},c=h(e,["order","value"]);return f({ourProps:r,theirProps:c,slot:i,attrs:n,slots:o,name:"ComboboxOption"})}}});export{ne as i,te as l,oe as n,ie as r,le as u};
//# sourceMappingURL=combobox-DA5SnpWu.mjs.map
