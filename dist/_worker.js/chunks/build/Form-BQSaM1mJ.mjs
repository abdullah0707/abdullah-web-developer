import{c as e}from"../_/index.mjs";import{a as t,v as r}from"./server.mjs";import{q as a,k as n}from"../routes/renderer.mjs";import"../_/nitro.mjs";import"../_/index2.mjs";import"../_/shared.esm-bundler.mjs";class FormException extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,FormException.prototype)}}const s=r.defineComponent({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(t,{expose:a,emit:n}){const s=r.useId(),i=e(`form-${s}`),o=r.ref(null),u=r.ref([]);r.provide("form-errors",u),r.provide("form-events",i);const l=r.ref({});async function getErrors(){let e=await t.validate(t.state);if(t.schema){const{errors:r,result:a}=await function(e,t){if(isStandardSchema(t))return validateStandardSchema(e,t);if(function(e){return void 0!==e.validateAsync&&void 0!==e.id}(t))return async function(e,t){try{return{errors:null,result:await t.validateAsync(e,{abortEarly:!1})}}catch(e){if(function(e){return!0===e.isJoi}(e)){return{errors:e.details.map(e=>({path:e.path.join("."),message:e.message})),result:null}}throw e}}(e,t);if(function(e){return e.validate&&e.__isYupSchema__}(t))return async function(e,t){try{return{errors:null,result:await t.validate(e,{abortEarly:!1})}}catch(e){if(function(e){return void 0!==e.inner}(e)){return{errors:e.inner.map(e=>{var t;return{path:null!=(t=e.path)?t:"",message:e.message}}),result:null}}throw e}}(e,t);if(function(e){return"schema"in e&&"function"==typeof e.coercer&&"function"==typeof e.validator&&"function"==typeof e.refiner}(t))return async function(e,t){const[r,a]=t.validate(e);if(r){return{errors:r.failures().map(e=>({message:e.message,path:e.path.join(".")})),result:null}}return{errors:null,result:a}}(e,t);throw new Error("Form validation failed: Unsupported form schema")}(t.state,t.schema);r?e=e.concat(r):o.value=a}return e}async function validate(e,r={silent:!1}){let a=e;if(e&&!Array.isArray(e)&&(a=[e]),a){const e=u.value.filter(e=>!a.includes(e.path)),t=(await getErrors()).filter(e=>a.includes(e.path));u.value=e.concat(t)}else u.value=await getErrors();if(u.value.length>0){if(r.silent)return!1;throw new FormException(`Form validation failed: ${JSON.stringify(u.value,null,2)}`)}return t.state}async function onSubmit(e){var r;const a=e;try{(null==(r=t.validateOn)?void 0:r.includes("submit"))&&await validate(),a.data=t.schema?o.value:t.state,n("submit",a)}catch(e){if(!(e instanceof FormException))throw e;const t={...a,errors:u.value.map(e=>({...e,id:l.value[e.path]}))};n("error",t)}}return r.provide("form-inputs",l),a({validate:validate,errors:u,setErrors(e,t){u.value=t?u.value.filter(e=>e.path!==t).concat(e):e},async submit(){await onSubmit(new Event("submit"))},getErrors:e=>e?u.value.filter(t=>t.path===e):u.value,clear(e){u.value=e?u.value.filter(t=>t.path!==e):[]}}),{onSubmit:onSubmit,errors:r.readonly(u)}}});function isStandardSchema(e){return"~standard"in e}async function validateStandardSchema(e,t){const r=await t["~standard"].validate(e);if(!r.issues||0===r.issues.length){return{errors:null,result:"value"in r?r.value:null}}return{errors:r.issues.map(e=>{var t;return{path:(null==(t=e.path)?void 0:t.map(e=>"object"==typeof e?e.key:e).join("."))||"",message:e.message}}),result:null}}const i=s.setup;s.setup=(e,t)=>{const a=r.useSSRContext();return(a.modules||(a.modules=new Set)).add("node_modules/@nuxt/ui/dist/runtime/components/forms/Form.vue"),i?i(e,t):void 0};const o=t(s,[["ssrRender",function(e,t,r,s,i,o,u,l){t(`<form${a(s)}>`),n(e.$slots,"default",{errors:e.errors},null,t,r),t("</form>")}]]);export{o as default,isStandardSchema,validateStandardSchema};
//# sourceMappingURL=Form-BQSaM1mJ.mjs.map
